<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:viewModels="clr-namespace:OneWare.ChatBot.ViewModels"
             xmlns:avaloniaEdit="https://github.com/avaloniaui/avaloniaedit"
             xmlns:controls="clr-namespace:OneWare.Essentials.Controls;assembly=OneWare.Essentials"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="OneWare.ChatBot.Views.ChatMessageView" x:DataType="viewModels:ChatMessageViewModel">
    <UserControl.Styles>
        <Style Selector="Border.message">
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeBorderLowBrush}" />
            <Setter Property="Padding" Value="12" />
            <Setter Property="MaxWidth" Value="640" />
            <Setter Property="HorizontalAlignment" Value="Left" />
        </Style>
        <Style Selector="Border.message.user">
            <Setter Property="Background" Value="{DynamicResource ThemeControlMidBrush}" />
            <Setter Property="HorizontalAlignment" Value="Right" />
        </Style>
        <Style Selector="Border.message.assistant">
            <Setter Property="Background" Value="{DynamicResource ThemeBackgroundBrush}" />
        </Style>
        <Style Selector="TextBlock.meta">
            <Setter Property="Foreground" Value="{DynamicResource ThemeForegroundLowBrush}" />
            <Setter Property="FontSize" Value="11" />
        </Style>
        <Style Selector="TextBlock.streaming">
            <Setter Property="Foreground" Value="{DynamicResource ThemeForegroundLowBrush}" />
            <Setter Property="FontStyle" Value="Italic" />
            <Setter Property="FontSize" Value="11" />
        </Style>
    </UserControl.Styles>
    <Border Classes="message"
            Classes.user="{Binding IsUser}"
            Classes.assistant="{Binding IsAssistant}">
        <StackPanel Spacing="6">
            <DockPanel LastChildFill="False">
                <TextBlock Text="{Binding Author}" FontWeight="Bold" />
                <TextBlock Classes="meta" DockPanel.Dock="Right"
                           Text="{Binding Timestamp, StringFormat={}{0:t}}" />
            </DockPanel>
            <controls:MarkdownViewer Markdown="{Binding Message}">
                <controls:MarkdownViewer.Styles>
                    <Style Selector="avaloniaEdit|TextEditor">
                        <Style.Setters>
                            <Setter Property="FontFamily" Value="{DynamicResource EditorFont}" />
                            <Setter Property="HorizontalScrollBarVisibility" Value="Disabled" />
                            <Setter Property="VerticalScrollBarVisibility" Value="Disabled" />
                        </Style.Setters>
                    </Style>

                    <Style Selector="Border.CodeBlock">
                        <Setter Property="Margin" Value="0" />
                        <Setter Property="Padding" Value="6" />
                        <Setter Property="CornerRadius" Value="4" />
                        <Setter Property="Background" Value="{DynamicResource ThemeControlLowBrush}"/>
                    </Style>
                </controls:MarkdownViewer.Styles>
            </controls:MarkdownViewer>
            <TextBlock Classes="streaming" Text="Thinking..." IsVisible="{Binding IsStreaming}" />
        </StackPanel>
    </Border>
</UserControl>
