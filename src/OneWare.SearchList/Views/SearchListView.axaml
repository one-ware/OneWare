<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:viewModels="clr-namespace:OneWare.SearchList.ViewModels"
             xmlns:models="clr-namespace:OneWare.SearchList.Models"
             xmlns:controls="clr-namespace:OneWare.Essentials.Controls;assembly=OneWare.Essentials"
             xmlns:behaviors="clr-namespace:OneWare.Essentials.Behaviors;assembly=OneWare.Essentials"
             mc:Ignorable="d" d:DesignWidth="600" d:DesignHeight="250"
             x:Class="OneWare.SearchList.Views.SearchListView" x:DataType="viewModels:SearchListViewModel"
             Background="{DynamicResource ThemeControlLowBrush}">

    <Grid RowDefinitions="30,Auto,*">

        <Border Background="{DynamicResource ThemeBackgroundBrush}" Padding="2">
            <DockPanel Name="InformationPanel">
                <StackPanel DockPanel.Dock="Right" Classes="ToolBar">

                    <Separator />

                    <ToggleButton Classes="RoundButton" Width="24" IsChecked="{Binding CaseSensitive}"
                                  ToolTip.Tip="Case Sensitive">
                        <Image VerticalAlignment="Center" HorizontalAlignment="Center" Height="16" Width="16"
                               Source="{DynamicResource VsImageLib.CaseSensitive16X}" />
                    </ToggleButton>

                    <ToggleButton Classes="RoundButton" Width="24" IsChecked="{Binding WholeWord}"
                                  ToolTip.Tip="Match whole words">
                        <Image VerticalAlignment="Center" HorizontalAlignment="Center" Height="16" Width="16"
                               Source="{DynamicResource VsCodeLight.Whole-Word}" />
                    </ToggleButton>
                    <ToggleButton Classes="RoundButton" Width="24" IsChecked="{Binding UseRegex}"
                                  ToolTip.Tip="Use Regex">
                        <Image VerticalAlignment="Center" HorizontalAlignment="Center" Height="16" Width="16"
                               Source="{DynamicResource VsCodeLight.Regex}" />
                    </ToggleButton>

                    <Separator />

                    <ToggleButton Classes="RoundButton" Width="24" IsChecked="{Binding IsReplaceVisible}"
                                  ToolTip.Tip="Replace">
                        <TextBlock Text="R" FontSize="12" VerticalAlignment="Center" HorizontalAlignment="Center" />
                    </ToggleButton>

                    <Separator />

                    <ComboBox
                        SelectedIndex="{Binding SearchListFilterMode}"
                        Width="140">
                        <ComboBoxItem>All open projects</ComboBoxItem>
                        <ComboBoxItem>Current project</ComboBoxItem>
                        <ComboBoxItem>Current file</ComboBoxItem>
                    </ComboBox>

                </StackPanel>
                
                <Border DockPanel.Dock="Left" Classes="RoundBorder" Background="{DynamicResource ThemeControlMidBrush}"
                        Height="24" Margin="0 0 5 0">
                    <Panel>
                        <controls:SearchBox SearchText="{Binding SearchString}"
                                            HorizontalAlignment="Stretch">
                            <Interaction.Behaviors>
                                <FocusOnAttachedToVisualTreeBehavior />
                                <behaviors:DataGridNavigationBehavior AssociatedDataGrid="{Binding #SearchList}" />
                                <behaviors:CommandOnKeyPressedBehavior TriggerKey="Enter" HandledEventsToo="False"
                                                                       Command="{Binding OpenSelectedResult}" />
                            </Interaction.Behaviors>
                        </controls:SearchBox>
                        <controls:Spinner HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0 0 50 0" Height="12" Width="12" IsVisible="{Binding IsLoading}" />
                    </Panel>
                   
                </Border>
            </DockPanel>
        </Border>

        
        <Border Grid.Row="1" Background="{DynamicResource ThemeBackgroundBrush}" Padding="2"
                IsVisible="{Binding IsReplaceVisible}">
            <DockPanel>
                <StackPanel DockPanel.Dock="Right" Orientation="Horizontal" Spacing="4">
                    <Button Classes="RoundButton" MinWidth="70"
                            Command="{Binding ReplaceSelectedCommand}">
                        <TextBlock Text="Replace" />
                    </Button>
                    <Button Classes="RoundButton" MinWidth="80"
                            Command="{Binding ReplaceAllCommand}">
                        <TextBlock Text="Replace All" />
                    </Button>
                </StackPanel>

                <Border DockPanel.Dock="Left" Classes="RoundBorder"
                        Background="{DynamicResource ThemeControlMidBrush}"
                        Height="24" Margin="0 0 5 0">
                    <TextBox Background="Transparent" BorderThickness="0"
                             Watermark="Replace..." Text="{Binding ReplaceString}"
                             Padding="6,0,0,0" VerticalContentAlignment="Center" />
                </Border>
            </DockPanel>
        </Border>

        <DataGrid Padding="2, 0, 2, 2" BorderThickness="0" VerticalGridLinesBrush="Transparent"
                  ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                  Grid.Row="2" Background="Transparent"
                  RowBackground="Transparent" IsReadOnly="True"
                  x:Name="SearchList" ItemsSource="{Binding Items}"
                  SelectedItem="{Binding SelectedItem}"
                  CanUserResizeColumns="True" CanUserSortColumns="True">
            <Interaction.Behaviors>
                <behaviors:CommandOnDoubleTapBehavior
                    Command="{Binding OpenSelectedResult}" />
            </Interaction.Behaviors>
            <DataGrid.Columns>
                <DataGridTemplateColumn CanUserResize="True" Width="4*" SortMemberPath="Description">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate DataType="models:SearchResultModel">
                            <TextBlock Padding="5 0" ToolTip.Tip="{Binding Description}">
                                <Run Text="{Binding DescriptionLeft}" /><!--
                                --><Run Text="{Binding DescriptionMid}" FontWeight="Bold" Background="{DynamicResource ThemeAccentBrush2}" /><!--
                                --><Run Text="{Binding DescriptionRight}" />
                            </TextBlock>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                    <DataGridTemplateColumn.Header>
                        <TextBlock Text="Code" />
                    </DataGridTemplateColumn.Header>
                </DataGridTemplateColumn>

                <DataGridTemplateColumn CanUserResize="True" Width="*" SortMemberPath="Project.Header">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate DataType="models:SearchResultModel">
                            <TextBlock Padding="5 0" VerticalAlignment="Center"
                                       Text="{Binding Project.Header, FallbackValue={x:Null}}" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                    <DataGridTemplateColumn.Header>
                        <TextBlock Text="Project" />
                    </DataGridTemplateColumn.Header>
                </DataGridTemplateColumn>

                <DataGridTemplateColumn CanUserResize="True" Width="*" SortMemberPath="FileName">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate DataType="models:SearchResultModel">
                            <TextBlock Padding="5 0" VerticalAlignment="Center"
                                       Text="{Binding FileName, FallbackValue={x:Null}}" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                    <DataGridTemplateColumn.Header>
                        <TextBlock Text="File" />
                    </DataGridTemplateColumn.Header>
                </DataGridTemplateColumn>

                <DataGridTemplateColumn CanUserResize="True" Width="40" SortMemberPath="Line">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate DataType="models:SearchResultModel">
                            <TextBlock Padding="5 0" VerticalAlignment="Center" Text="{Binding LineString}" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                    <DataGridTemplateColumn.Header>
                        <TextBlock Text="Line" />
                    </DataGridTemplateColumn.Header>
                </DataGridTemplateColumn>

            </DataGrid.Columns>
        </DataGrid>
    </Grid>
</UserControl>
