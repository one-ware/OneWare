<controls:FlexibleWindow xmlns="https://github.com/avaloniaui"
                         xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                         xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                         xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                         mc:Ignorable="d"
                         xmlns:windows="clr-namespace:OneWare.Core.ViewModels.Windows"
                         xmlns:controls="clr-namespace:OneWare.Essentials.Controls;assembly=OneWare.Essentials"
                         xmlns:converters="clr-namespace:OneWare.Essentials.Converters;assembly=OneWare.Essentials"
                         xmlns:models="clr-namespace:OneWare.Essentials.Models;assembly=OneWare.Essentials"
                         x:Class="OneWare.Core.Views.Windows.MessageBoxWindow"
                         SizeToContent="Height"
                         MinHeight="100"
                         PrefWidth="350"
                         Padding="4"
                         Focusable="True"
                         Foreground="{DynamicResource ThemeForegroundBrush}"
                         Name="MessageWindow" x:CompileBindings="True" x:DataType="windows:MessageBoxViewModel"
                         WindowStartupLocation="CenterOwner">

    <UserControl.Styles>
        <Style Selector="Button.MessageBoxDanger">
            <Setter Property="Background" Value="#C14646" />
            <Setter Property="Foreground" Value="#F6F6F6" />
        </Style>
    </UserControl.Styles>

    <DockPanel Margin="4" LastChildFill="False">
        <StackPanel DockPanel.Dock="Top" Orientation="Vertical" Spacing="4">
            <controls:MarkdownViewer Margin="2" Markdown="{Binding Message}" MaxHeight="300" />

            <Border Classes="RoundToolBar" IsVisible="{Binding ShowInput}"
                    BorderBrush="{DynamicResource ThemeBorderMidBrush}">
                <DockPanel>
                    <DockPanel>
                        <StackPanel Orientation="Horizontal" DockPanel.Dock="Right"
                                    IsVisible="{Binding ShowFolderButton}">
                            <Separator />
                            <Button Command="{Binding SelectPathAsync}" CommandParameter="{Binding #MessageWindow}">
                                <Image Height="16" Width="16" VerticalAlignment="Center"
                                       Source="{DynamicResource VsImageLib.FolderOpen16X}" />
                            </Button>
                        </StackPanel>

                        <StackPanel DockPanel.Dock="Left" Spacing="2">
                            <TextBlock IsVisible="{Binding ShowInputLabel}" Text="{Binding InputLabel}" />
                            <TextBox Name="InputBox" Text="{Binding Input, Mode=TwoWay}"
                                     PasswordChar="{Binding PasswordChar}"
                                     Watermark="{Binding InputPlaceholder}" />
                        </StackPanel>
                    </DockPanel>
                </DockPanel>
            </Border>

            <ComboBox IsVisible="{Binding ShowSelection}" ItemsSource="{Binding SelectionItems}"
                      SelectedItem="{Binding SelectedItem}" />
        </StackPanel>
        <ItemsControl Margin="0 8 0 0" DockPanel.Dock="Bottom" HorizontalAlignment="Right"
                      ItemsSource="{Binding Buttons}">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <StackPanel Classes="WindowButtons" />
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
                <DataTemplate x:DataType="windows:MessageBoxButtonViewModel">
                    <Button Content="{Binding Text}"
                            Classes="WindowButton"
                            Classes.PrimaryButton="{Binding Model.Style, Converter={x:Static converters:SharedConverters.ComparisonConverter}, ConverterParameter={x:Static models:MessageBoxButtonStyle.Primary}}"
                            Classes.SecondaryButton="{Binding Model.Style, Converter={x:Static converters:SharedConverters.ComparisonConverter}, ConverterParameter={x:Static models:MessageBoxButtonStyle.Secondary}}"
                            Classes.MessageBoxDanger="{Binding Model.Style, Converter={x:Static converters:SharedConverters.ComparisonConverter}, ConverterParameter={x:Static models:MessageBoxButtonStyle.Danger}}"
                            IsDefault="{Binding IsDefault}"
                            IsCancel="{Binding IsCancel}"
                            Command="{Binding #MessageWindow.((windows:MessageBoxViewModel)DataContext).ButtonCommand, FallbackValue={x:Null}}"
                            CommandParameter="{Binding}" />
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>
    </DockPanel>

</controls:FlexibleWindow>